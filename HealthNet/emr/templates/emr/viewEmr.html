{% extends 'user/base.html' %}

{% block content %}
    <form action="" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class = "emr_toolbox">
            {{ form.keywords }}
            <div class="emr_toolbox_wrap">
                <input type = "button" class="emr_toolbox_item" value="Filter"/>
                <div class="drop_down">
                    <input type="button" class="emr_toolbox_label" value="Prescriptions" />{{ form.filters.0.tag }}
                    <input type="button" class="emr_toolbox_label" value="Vitals" />{{ form.filters.1.tag }}
                    <input type="button" class="emr_toolbox_label" value="Test Results" />{{ form.filters.2.tag }}
                    <input type="button" class="emr_toolbox_label" value="Pending Test Results" />{{ form.filters.3.tag }}
                    <input type="button" class="emr_toolbox_label" value="Admissions" />{{ form.filters.4.tag }}
                    <input type="button" class="emr_toolbox_label" value="Dishcharge" />{{ form.filters.5.tag }}
                    <input type = "button" class="emr_toolbox_action" value="Show Unreleased" data-filter = "get_unreleased" onclick="set_filter_and_submit(this)"/>
                    <input type = "button" class="emr_toolbox_action" value="Show New" data-filter = "get_new" onclick="set_filter_and_submit(this)"/>
                    <input type = "button" class="emr_toolbox_action" value="Reset All Filters" data-filter = "reset" onclick="set_filter_and_submit(this)"/>
                    <input type="hidden" name="filter" id = "form_filter" value="">
                </div>
            </div>

            <div class="emr_toolbox_wrap">
                <input type = "button" class="emr_toolbox_item" value="Sort"/>
                <div class="drop_down">
                    <input class="emr_toolbox_label" value="Alphabetical" />{{ form.sort.0.tag }}
                    <input class="emr_toolbox_label" value="Date" />{{ form.sort.1.tag }}
                    <input class="emr_toolbox_label" value="Priority" />{{ form.sort.2.tag }}
                    <input type = "button" class="emr_toolbox_action" value="Reset Radio Buttons" onclick="unselect_radio_set('sort')"/>
                </div>
            </div>

            <div class="emr_toolbox_wrap">
                <input type = "button" class="emr_toolbox_item" value="Actions"/>
                <div class="drop_down">
                    {% if permissions.canVitals or permissions.canEdit %}
                        <input type = "button" class="emr_toolbox_action" value="New Vitals" data-action = "get_new" onclick="window.location='{% url 'emr:cvitals' tuser.id %}'"/>
                        <input type = "button" class="emr_toolbox_action" value="EMR Profile" onclick="window.location='{% url 'emr:eprofile' tuser.id %}'"/>
                    {% endif %}
                    {% if permissions.canEdit %}
                        <input type = "button" class="emr_toolbox_action" value="New Test" onclick="window.location='{% url 'emr:ctest' tuser.id %}'"/>
                        <input type = "button" class="emr_toolbox_action" value="New EMR Item" onclick="window.location='{% url 'emr:citem' tuser.id %}'"/>
                    {% endif %}
                    {% if permissions.canPrescribe %}
                        <input type = "button" class="emr_toolbox_action" value="New Prescription" onclick="window.location='{% url 'emr:cpre' tuser.id %}'"/>
                    {% endif %}
                    {% if permissions.canAdmit %}
                        {% if admit == 'admit' %}
                            <input type = "button" class="emr_toolbox_action" value="Discharge Patient" onclick="window.location='{% url 'emr:admitdischarge' tuser.id %}'"/>
                        {% else %}
                            <input type = "button" class="emr_toolbox_action" value="Admit Patient" onclick="window.location='{% url 'emr:admitdischarge' tuser.id %}'"/>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <input type = "submit" value="Submit" class="emr_toolbox_submit" />
        </div>
    </form>

    {% if EMRProfile %}
    <div class="card_wrapper">
        <div class="card_hf bottomborder profile">{{ tuser.user.get_full_name }}'s Profile</div>
        <div class="card_body">
            <table>
               <tr><td>Insurance Number: </td><td>{{ EMRProfile.getInumber }}</td></tr>
                <tr><td>Birthdate: </td><td>{{ EMRProfile.birthdate }}</td></tr>
                <tr><td>Age:</td><td>{{ EMRProfile.getAge }}</td></tr>
                <tr><td>Gender: </td><td>{{ EMRProfile.gender }}</td></tr>
                <tr><td>Blood Type: </td><td>{{ EMRProfile.blood_type }}</td></tr>
                <tr><td>Family History: </td><td>{{ EMRProfile.family_history }}</td></tr>
                <tr><td>Comments: </td><td>{{ EMRProfile.comments }}</td></tr>
                {% if hospital %}
                    <tr><td>Admitted To:</td><td>{{ hospital.name }}</td></tr>
                {% endif %}
            </table>
        </div>
        <div class="card_hf topborder"><input type = "button" value = "details"/>
                <input type = "button" value = "edit" onclick="window.location='{% url 'emr:eprofile' tuser.id %}'"/></div>
    </div>
    {% endif %}

    {% for item in EMRItems %}
        <div class = "card_wrapper">
            <div class="card_hf bottomborder {{ item.getType }}">{{ item.title }}</div>

            <div class = "card_body">
                <table>
                    {% if item.emrtest %}
                        <img src="{{ item.emrtest.image.path }}" />
                    {% elif item.emrvitals %}
                        <tr><td>Resting BPM:</td><td>{{ item.emrvitals.restingBPM }}</td></tr>
                        <tr><td>Blood Pressure:</td><td>{{ item.emrvitals.bloodPressure }}</td></tr>
                        <tr><td>Height:</td><td>{{ item.emrvitals.height }}</td></tr>
                        <tr><td>Weight:</td><td>{{ item.emrvitals.weight }}</td></tr>
                    {% elif item.emrprescription %}
                        <tr><td>Dosage:</td><td>{{ item.emrprescription.dosage }}</td></tr>
                        <tr><td>Dose/day:</td><td>{{ item.emrprescription.amountPerDay }}</td></tr>
                        <tr><td>Start Date:</td><td>{{ item.emrprescription.startDate }}</td></tr>
                        <tr><td>End Date:</td><td>{{ item.emrprescription.endDate }}</td></tr>
                        <tr><td>Provider:</td><td>{{ item.emrprescription.proivder.get_full_name }}</td></tr>
                    {% endif %}
                    {{ item.content }}
                </table>
            </div>

            <div class = "card_hf topborder">
                <input type = "button" value = "details" />
                <input type = "button" value = "edit" onclick="window.location='{% url 'emr:eemrItem' item.id %}'"/>
                <li>Priority: {{ item.priority }}</li>
            </div>
        </div>
    {% endfor %}
{% endblock %}